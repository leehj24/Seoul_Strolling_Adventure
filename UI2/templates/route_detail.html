<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>{{ title }} – 여행 추천 코스</title>

<style>
/* ─── 기본 ─── */
*{margin:0;padding:0;box-sizing:border-box;}
body{font-family:'Apple SD Gothic Neo',sans-serif;background:#fafafa;color:#111;}
a{color:inherit;text-decoration:none;}

header{padding:1rem 2rem;border-bottom:1px solid #eee;background:#fff;}
.back{font-size:.95rem;display:inline-flex;align-items:center;gap:.25rem;cursor:pointer;}
.back svg{width:16px;height:16px;fill:#111;}

.title-wrap{padding:2rem 2rem 1rem;}
.title-wrap h2{font-size:1.6rem;font-weight:700;margin-bottom:.3rem;}
.title-wrap p{color:#666;margin-bottom:.5rem;}

/* ─── 카드 & 레이아웃 ─── */
.card-list{
  position:relative;
  padding:0 2rem 2rem 3rem;      /* ← 왼쪽 공간 확보 */
  overflow:visible;              /* 배지(●) 잘리지 않게 */
}
.card-list::before{              /* 세로선 */
  content:"";
  position:absolute;
  left:1.25rem;top:0;bottom:0;
  width:2px;background:#e0e0e0;
}

.card{
  position:relative;margin-bottom:1.25rem;background:#fff;
  border:1px solid #ddd;border-radius:6px;padding:1.25rem 1.75rem;
  cursor:pointer;transition:.15s;
}
.card:hover{box-shadow:0 3px 10px rgba(0,0,0,.06);}

.badge{
  position:absolute;left:-1.5rem;top:18px;
  width:36px;height:36px;border-radius:50%;background:#111;color:#fff;
  display:flex;align-items:center;justify-content:center;font-weight:600;font-size:.9rem;
}

.card-title{font-size:1.05rem;font-weight:600;margin-bottom:.75rem;line-height:1.4;}
.card-title small{font-size:.8rem;color:#888;font-weight:400;}
.route-box{
  height:40px;background:#00000010;border-radius:4px;
  display:flex;align-items:center;justify-content:center;font-size:.9rem;color:#555;
}
.tag-list{display:flex;flex-wrap:wrap;gap:.4rem;}
.tag{
  background:#f1f1f1;border-radius:4px;padding:.35rem .65rem;font-size:.85rem;
  white-space:nowrap;
}

/* ─── 모달 ─── */
dialog{
  border:none;border-radius:8px;padding:0;max-width:420px;width:90%;
  box-shadow:0 6px 18px rgba(0,0,0,.25);

  position:fixed;       /* 화면 기준 고정 */
  top:50%;left:50%;
  transform:translate(-50%,-50%);  /* 정확한 중앙 */
}
dialog::backdrop{background:rgba(0,0,0,.4);}

.modal-head{background:#111;color:#fff;padding:1rem 1.25rem;
            display:flex;justify-content:space-between;align-items:center;}
.modal-body{padding:1.25rem;font-size:.95rem;line-height:1.5;color:#333;}
.close-btn{background:none;border:none;color:#fff;font-size:1.25rem;cursor:pointer;}

@media(max-width:480px){
  .title-wrap{padding:1.5rem 1rem .75rem;}
  .card-list{padding:0 1rem 1.5rem 2.5rem;}
  .card{padding:1rem 1.25rem;}
  .badge{width:32px;height:32px;font-size:.8rem;}
}
</style>
</head>
<body>

<!-- 헤더 -->
<header>
  <a class="back" href="{{ url_for('chat') }}">
    <svg viewBox="0 0 24 24"><path d="M15 18 9 12 15 6"/></svg>
    채팅으로 돌아가기
  </a>
</header>

<!-- 타이틀 -->
<section class="title-wrap">
  <h2>{{ title }}</h2>
  <p>{{ subtitle }}</p>
</section>

<!-- 카드 리스트 -->
<section class="card-list">
  {% for leg in legs %}
    {% set r_no = loop.index * 2 - 1 %}
    {% set m_no = loop.index * 2 %}

    <!-- 이동 카드 -->
    <div class="card info-card"
         data-type="route"
         data-start="{{ leg.start }}"
         data-end="{{ leg.end }}"
         data-transport="{{ leg.transport }}">
      <div class="badge">{{ r_no }}</div>
      <div class="card-title">
        {{ leg.start }} → {{ leg.end }}
        <small>({{ leg.transport }})</small>
      </div>
      <div class="route-box">경로 세부 정보 보기</div>
    </div>

    <!-- 맛집 카드 -->
    <div class="card info-card"
         data-type="recs"
         data-reclist="{{ leg.recs|join(', ') }}">
      <div class="badge">{{ m_no }}</div>
      <div class="card-title">추천 맛집 ({{ leg.recs|length }}곳)</div>
      <div class="tag-list">
        {% for r in leg.recs[:5] %}
          <span class="tag">{{ r }}</span>
        {% endfor %}
        {% if not leg.recs %}
          <span style="color:#aaa;">추천 정보가 없습니다.</span>
        {% endif %}
      </div>
    </div>
  {% endfor %}
</section>

{% if busy_img_data %}
  <div style="padding: 2rem; text-align: center;">
    <h3 style="margin-bottom: 1rem;">혼잡도 그래프</h3>
    <img src="data:image/png;base64,{{ busy_img_data }}" alt="혼잡도 그래프" style="max-width:90%; height:auto; border-radius:8px;">
  </div>
{% endif %}

<!-- 모달 -->
<dialog id="info-modal">
  <div class="modal-head">
    <h3 id="modal-title" style="font-size:1.1rem;font-weight:600;"></h3>
    <button class="close-btn" aria-label="닫기" onclick="modal.close()">×</button>
  </div>
  <div class="modal-body" id="modal-body"></div>
</dialog>

<script>
const modal  = document.getElementById('info-modal');
const mTitle = document.getElementById('modal-title');
const mBody  = document.getElementById('modal-body');

document.querySelectorAll('.info-card').forEach(card=>{
  card.addEventListener('click', ()=>{
    const type = card.dataset.type;
    if(type === 'route'){
      mTitle.textContent = `이동 경로 – ${card.dataset.start} → ${card.dataset.end}`;
      mBody.innerHTML = `
        <p><strong>교통수단 :</strong> ${card.dataset.transport}</p>
        <p>출발지 : ${card.dataset.start}<br>도착지 : ${card.dataset.end}</p>`;
    }else{
      const list = card.dataset.reclist.split(',').map(s=>s.trim()).filter(Boolean);
      mTitle.textContent = '추천 맛집 상세';
      mBody.innerHTML = list.length
        ? '<ul style="padding-left:1.2rem;">' + list.map(r=>`<li>${r}</li>`).join('') + '</ul>'
        : '<p>추천 정보가 없습니다.</p>';
    }
    modal.showModal();
  });
});
</script>

</body>
</html>
