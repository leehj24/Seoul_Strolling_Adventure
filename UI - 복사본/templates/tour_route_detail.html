<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>{{ title }} – 추천 상세</title>

<style>
/* ─── 기본 ─── */
* { margin: 0; padding: 0; box-sizing: border-box; }
body { font-family: 'Apple SD Gothic Neo', sans-serif; background: #fafafa; color: #333; }

/* ─── 헤더 ─── */
header {
  padding: 1rem 2rem;
  background: #fff;
  border-bottom: 1px solid #eee;
  display: flex;
  align-items: center;
}
header a {
  font-size: 0.95rem;
  text-decoration: none;
  color: #333;
  display: flex;
  align-items: center;
  gap: 0.5rem;
}

/* ─── 타이틀 ─── */
.title-wrap {
  padding: 2rem;
  text-align: center;
}
.title-wrap h2 { font-size: 1.6rem; margin-bottom: 0.5rem; }
.title-wrap p { color: #666; }

/* ─── 카드 리스트 ─── */
.card-list {
  padding: 1rem 2rem;
  display: flex;
  flex-direction: column;
  gap: 1rem;
}
.card {
  background: #fff;
  border: 1px solid #ddd;
  border-radius: 8px;
  padding: 1rem;
  cursor: pointer;
  transition: 0.2s;
}
.card:hover { 
  box-shadow: 0 4px 10px rgba(0,0,0,0.1); 
  transform: translateY(-2px); 
}
.card-title { font-size: 1.1rem; font-weight: 600; margin-bottom: 0.5rem; }
.card-sub { font-size: 0.95rem; color: #666; }

/* ─── 모달 ─── */
dialog {
  border: none;
  border-radius: 8px;
  padding: 0;
  max-width: 420px;
  width: 90%;
  box-shadow: 0 6px 18px rgba(0,0,0,0.25);

  position: fixed;
  top: 50%; left: 50%;
  transform: translate(-50%, -50%);
}
dialog::backdrop {
  background: rgba(0, 0, 0, 0.4);
}

/* ─── 모달 내부 ─── */
.modal-head {
  background: #111;
  color: #fff;
  padding: 1rem 1.25rem;
  display: flex;
  justify-content: space-between;
  align-items: center;
}
.modal-head h3 {
  font-size: 1.1rem;
  font-weight: 600;
  margin: 0;
}
.close-btn {
  background: none;
  border: none;
  color: #fff;
  font-size: 1.3rem;
  cursor: pointer;
}

.modal-body {
  background: #fff;
  padding: 1.25rem;
  font-size: 0.95rem;
  color: #333;
  line-height: 1.6;
}
.modal-body strong {
  font-weight: 600;
}
.group-box {
  background: #f7f7f7;
  border: 1px solid #ddd;
  border-radius: 8px;
  padding: 1rem;
  margin-bottom: 1rem;
}
</style>

</head>

<body>

<!-- ─── 헤더 ─── -->
<header>
  <a href="{{ url_for('chat') }}">← 채팅으로 돌아가기</a>
</header>

<!-- ─── 제목 ─── -->
<section class="title-wrap">
  <h2>{{ title }}</h2>
  <p>{{ subtitle }}</p>
</section>

<!-- ─── 카드 리스트 ─── -->
<section class="card-list">
  {% for key, value in details.items() %}
    {% if value %}
      {% if key == '추천장소3' %}
        {% set items = value.split(',') %}
        {% for i in range(0, items|length, 5) %}
          <div class="card" data-items="{{ items[i:i+5]|join(',') }}">
            <div class="card-title">{{ key }} ({{ loop.index }})</div>
            <div class="card-sub">
              {% for item in items[i:i+5] %}
                <div>{{ item.strip() }}</div>
              {% endfor %}
            </div>
          </div>
        {% endfor %}
      {% else %}
        <div class="card" data-key="{{ key }}" data-value="{{ value }}">
          <div class="card-title">{{ key }}</div>
          <div class="card-sub">{{ value }}</div>
        </div>
      {% endif %}
    {% endif %}
  {% endfor %}
</section>

<!-- ─── 모달 ─── -->
<dialog id="info-modal">
  <div class="modal-head">
    <h3 id="modal-title"></h3>
    <button class="close-btn" aria-label="닫기" onclick="modal.close()">×</button>
  </div>
  <div class="modal-body" id="modal-body"></div>
</dialog>

<!-- ─── 스크립트 ─── -->
<script>
const modal  = document.getElementById('info-modal');
const mTitle = document.getElementById('modal-title');
const mBody  = document.getElementById('modal-body');

// 카드 클릭
document.querySelectorAll('.card').forEach(card => {
  card.addEventListener('click', () => {
    const items = card.dataset.items;
    const key   = card.dataset.key;
    const value = card.dataset.value;

    if (items) {
      // 추천장소3 묶음 카드 클릭
      const itemList = items.split(',').map(x => x.trim());
      mTitle.textContent = "추천장소 상세보기";

      mBody.innerHTML = `
        <div style="padding:1rem; background:#f7f7f7; border-radius:8px;">
          ${itemList.map(x => `<div>${x}</div>`).join('')}
        </div>
      `;
    } else if (key && value) {
      // 일반 카드 클릭
      mTitle.textContent = key;
      mBody.innerHTML = `
        <strong>${key}</strong><br>
        ${value.split(',').join('<br>')}
      `;
    }

    if (!modal.open) {
      modal.showModal();
    }
  });
});
</script>

</body>
</html>
